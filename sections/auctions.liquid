<div class="auction-list-container">
  <h1>Active Auctions</h1>
  <div id="auction-list">
   
  </div>
</div>

<script>
 
  var customerId = {{ customer.id | json }};
</script>
<script>
document.addEventListener("DOMContentLoaded", async () => {
  const auctionListContainer = document.getElementById("auction-list");
  const apiUrl = "https://shopifyauctionapp-hrdhadb3f3f5gpdh.northeurope-01.azurewebsites.net/Auctions";

 
  function createAuctionCard(auction) {
    const startDate = new Date(auction.startDate).toLocaleString();
    const endDate = new Date(auction.endDate).toLocaleString();

    return `
      <div class="auction-card">
        <img src="${auction.imgUrlProduct}" alt="${auction.productTitle}" class="auction-image">
        <h2>${auction.productTitle}</h2>
        <p><strong>Start Price:</strong> $${auction.startPrice}</p>
        <p><strong>Current Price:</strong> $${auction.currentPrice}</p>
        <p><strong>Start Date:</strong> ${startDate}</p>
        <p><strong>End Date:</strong> ${endDate}</p>
        <button class="bid-button" onclick="bidOnAuction(${auction.id})">Place Bid</button>
      </div>
    `;
  }

 
  async function fetchAuctions() {
    try {
      const response = await fetch(apiUrl);
      if (!response.ok) throw new Error("Failed to fetch auctions.");
      const auctions = await response.json();

     
      if (auctions.length === 0) {
        auctionListContainer.innerHTML = "<p>No active auctions at the moment.</p>";
        return;
      }

    
      const auctionCards = auctions.map(createAuctionCard).join("");
      auctionListContainer.innerHTML = auctionCards;
    } catch (error) {
      console.error("Error fetching auctions:", error);
      auctionListContainer.innerHTML = `<p>Error loading auctions. Please try again later.</p>`;
    }
  }

  
  window.bidOnAuction = (auctionId) => {
    if (!customerId) {
      alert("You need to log in to place a bid.");
      return;
    }
    alert(`Bid placed on auction ID: ${auctionId}`);
  };

 
  fetchAuctions();
});
</script>