{%- if section.settings.show_announcement -%}
    <section>
      <div class="announcement-bar">
        <div class="announcement-bar-left-section">
          {%- if section.settings.image2 != blank -%}
            <img
              width="40"
              height="40"
              loading="lazy"
              src="{{ section.settings.image2 | image_url }}"
            >
          {%- else -%}
            <img
              width="40"
              height="40"
              loading="lazy"
              src="{{ 'logo.jpg' | asset_url }}"
            >
          {%- endif -%}
          {%- if section.settings.image != blank -%}
            <img
              width="35"
              height="35"
              loading="lazy"
              src="{{ section.settings.image | image_url }}"
            >
          {%- else -%}
            <img
              width="35"
              height="35"
              loading="lazy"
              src="{{ 'logo.jpg' | asset_url }}"
            >
          {%- endif -%}
        </div>
        <div>
          <ul class="announcement-bar-inner-list">
            <!--  Check if the customer is logged in -->
            {% if customer %}
              <!--  For logged in customer display email in the bar -->
              <li>Logged in user: {{ customer.email }}</li>
            {% endif %}
            {%- if section.blocks.size == 0 -%}  
              {% if shop.customer_accounts_enabled %}
                {% if customer %}
                  <!--  If customer accounts are enabled and customer is logged in, display account and logout links -->
                  <li>
                    <a href="/account">Account</a>
                  </li>
                  <li>
                    <a id="logout-link" href="/account/logout/">Logout</a>
                  </li>
                {% else %}
                  <!--  If customer accounts are enabled and customer is not logged in, display login link -->
                  <li>
                    <a href="/account/login">Sign in</a>
                  </li>
                {% endif %}
              {% endif %}
  
            {%- else -%}
              {% for block in section.blocks %}
                <li>
                  <a href="{{ block.settings.link }}">{{ block.settings.text | escape }}</a>
                </li>
              {% endfor %}
            {%- endif -%}
          </ul>
        </div>
      </div>
    </section>  
    <script>
      // Wait for the DOM to fully load before executing the script
      document.addEventListener('DOMContentLoaded', function() {
        // Retrieve the customer object from the server-side template
        var customer = {{ customer | json }};
        // Get the current path of the webpage
        var currentPath = window.location.pathname;
        // Redirect to login page if the customer is not logged in and not on login or register pages
        if (!customer) {
          if (currentPath !== '/account/login' && currentPath !== '/account/register') {
            window.location.href = '/account/login';
          }
        }

        // Get the logout link element
        var logoutLink = document.getElementById('logout-link');
        if (logoutLink) {
          // Add a click event listener to the logout link
          logoutLink.addEventListener('click', function(event) {
            event.preventDefault(); // Prevent the default link behavior
            // Send a GET request to the logout endpoint
            fetch('/account/logout', {
              method: 'GET'
            }).then(function(response) {
              // Redirect to login page if logout is successful
              if (response.ok) {
                window.location.href = '/account/login';
              } else {
                console.error('Logout failed'); // Log an error if logout fails
              }
            }).catch(function(error) {
              console.error('Error:', error); // Log any errors that occur during the fetch
            });
          });
        }
      });
    </script>

  {%- endif -%}

  <style>
    .announcement-bar {
      background: {{ section.settings.background }}
      ;
      color: {{ section.settings.text_color }}
      ;
    }
  </style>
  
  {% schema %}
  {
    "name": "Announcement bar",
    "settings": [
      {
        "type": "checkbox",
        "id": "show_announcement",
        "label": "Show announcement",
        "default": true
      },
      {
        "type": "image_picker",
        "id": "image",
        "label": "image",
        "info": "400 x 120px .png recommended"
      },
      {
        "type": "image_picker",
        "id": "image2",
        "label": "image2",
        "info": "400 x 120px .png recommended"
      },
      {
        "type": "color",
        "id": "background",
        "label": "Background",
        "default": "#F4F4F4"
      },
      {
        "type": "color",
        "id": "text_color",
        "label": "Text",
        "default": "#000000"
      }
    ],
    "blocks": [
      {
        "name": "Links",
        "type": "links",
        "limit": 4,
        "settings": [
          {
            "type": "text",
            "id": "text",
            "label": "Text",
            "default": "link"
          },
          {
            "type": "url",
            "id": "link",
            "label": "Link"
          }
        ]
      }
    ]
  }
  {% endschema %}