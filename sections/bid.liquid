<div class="auction-details-container">
  <h1 id="auction-title"></h1>
  <img id="auction-image" class="auction-image" alt="Auction Image">
  <p><strong>Start Price:</strong> <span id="start-price"></span></p>
  <p><strong>Current Price:</strong> <span id="current-price"></span></p>
  <p><strong>Start Date:</strong> <span id="start-date"></span></p>
  <p><strong>End Date:</strong> <span id="end-date"></span></p>
  
 
  <div class="bid-section">
    <label for="bid-input"><strong>Place Your Bid:</strong></label>
    <input type="number" id="bid-input" min="0" step="10">
    <button id="submit-bid">Submit Bid</button>
  </div>

  <div id="response-message"></div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", async () => {
    const auctionId = window.location.pathname.split("/").pop();
    const auctionApiUrl = `https://shopifyauctionapp-hrdhadb3f3f5gpdh.northeurope-01.azurewebsites.net/Bids`;

    const auctionTitle = document.getElementById("auction-title");
    const auctionImage = document.getElementById("auction-image");
    const startPrice = document.getElementById("start-price");
    const currentPrice = document.getElementById("current-price");
    const startDate = document.getElementById("start-date");
    const endDate = document.getElementById("end-date");
    const bidInput = document.getElementById("bid-input");
    const submitBidButton = document.getElementById("submit-bid");
    const responseMessage = document.getElementById("response-message");

  
    try {
      const response = await fetch(auctionApiUrl);
      if (!response.ok) throw new Error("Failed to fetch auction details.");
      const auction = await response.json();

    
      auctionTitle.textContent = auction.productTitle;
      auctionImage.src = auction.imgUrlProduct;
      startPrice.textContent = `$${auction.startPrice}`;
      currentPrice.textContent = `$${auction.currentPrice}`;
      startDate.textContent = new Date(auction.startDate).toLocaleString();
      endDate.textContent = new Date(auction.endDate).toLocaleString();
    } catch (error) {
      console.error("Error fetching auction details:", error);
      responseMessage.textContent = "Error loading auction details.";
    }
submitBidButton.addEventListener("click", async () => {
  const price = parseFloat(bidInput.value);
  if (!price || price <= 0) {
    responseMessage.textContent = "Please enter a valid bid.";
    return;
  }

  try {
    // Konvertovanje auctionId u broj
    const auctionIdAsInt = parseInt(auctionId, 10);

    // Konvertovanje customerId u string
    const customerIdAsString = String(customerId);

    // Kreiranje payloada sa pravilnim tipovima podataka
    const bidPayload = { 
      auctionId: auctionIdAsInt, 
      price, 
      customerId: customerIdAsString 
    };

    const response = await fetch(auctionApiUrl, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(bidPayload),
    });

    if (!response.ok) throw new Error("Failed to submit bid.");
    responseMessage.textContent = "Your bid has been successfully placed!";
    bidInput.value = "";
  } catch (error) {
    console.error("Error submitting bid:", error);
    responseMessage.textContent = "Failed to place bid. Please try again.";
  }
});
</script>
