<section class="register">
  <div class="register-container">
  {% form 'create_customer' %}
    {{ form.errors | default_errors }}

    <div class="register-form">
      <div> 
        <div class="first-name">
          <label for="first-name">First name</label>
          <input type="text" name="customer[first_name]" id="first-name">
        </div>

        <div class="last-name">
          <label for="last-name">Last name</label>
          <input type="text" name="customer[last_name]" id="last-name">
        </div>

        <div class="email">
          <input placeholder="email" type="email" name="customer[email]" id="email" onfocus="hideTooltip('email-tooltip')">
          <!-- Email validation tooltip -->
          <span id="email-tooltip" class="tooltip" style="display: none;">Valid Levi9 email addresses can be used only.</span>
        </div>

        <div class="password">
          <input placeholder="password" type="password" name="customer[password]" id="password" onfocus="hideTooltip('password-tooltip')">
          <!-- Password validation tooltip -->
          <span id="password-tooltip" class="tooltip" style="display: none;">Password is too short (minimum is 5 characters).</span>
        </div>

        <div class="remember-me">
          <input type="checkbox" id="remember-me" name="remember_me">
          <label for="remember-me">Remember me</label>
        </div>

        <div>
          <!-- Submit button with validation function -->
          <input class="btn" type="submit" value="Create" onclick="return validateForm()">
        </div>

        <a href="{{ routes.account_login_url }}">Return to login page</a>
      
      </div>
    </div>
  {% endform %}
  </div>
</section>

<script>
  // Function to set a cookie
  function setCookie(cname, cvalue, exdays) {
    const d = new Date();
    d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000)); 
    const expires = "expires=" + d.toUTCString();
    document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/"; 
  }

  // Function to get a cookie value
  function getCookie(cname) {
    const name = cname + "=";
    const decodedCookie = decodeURIComponent(document.cookie);
    const ca = decodedCookie.split(';');
    for (let i = 0; i < ca.length; i++) {
      let c = ca[i];
      while (c.charAt(0) === ' ') {
        c = c.substring(1);
      }
      if (c.indexOf(name) === 0) {
        return c.substring(name.length, c.length); 
      }
    }
    return ""; 
  }

  // Function to validate the form inputs
  function validateForm() {
    // Get the email value and convert it to lowercase
    var email = document.getElementById('email').value.toLowerCase();
    // Get the password value
    var password = document.getElementById('password').value;
    // Regular expression pattern for validating email format
    var emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    // Extract the domain part of the email
    var domain = email.substring(email.lastIndexOf("@") + 1);
    // Get the tooltip elements for email and password
    var emailTooltip = document.getElementById('email-tooltip');
    var passwordTooltip = document.getElementById('password-tooltip');
    
    // Reset tooltips
    emailTooltip.style.display = 'none';
    passwordTooltip.style.display = 'none';

    var valid = true;

    // Validate the email format and domain
    if (!emailPattern.test(email) || domain !== 'levi9.com') {
      // Show the email tooltip if validation fails
      emailTooltip.style.display = 'inline';
      valid = false;
    }

    // Validate the password length
    if (password.length < 5) {
      // Show the password tooltip if validation fails
      passwordTooltip.style.display = 'inline';  // Show the password tooltip
      valid = false;
    }

    if (valid) {
      const rememberMeCheckbox = document.getElementById('remember-me');
      const emailField = document.querySelector('input[name="customer[email]"]');

      if (rememberMeCheckbox.checked) {
        setCookie("rememberedEmail", emailField.value, 30); // Cookie expires in 30 days
      } else {
        setCookie("rememberedEmail", "", -1); // Delete the cookie if not checked
      }
    }

    return valid;  // Return false if any validation fails
  }

  function hideTooltip(tooltipId) {
    document.getElementById(tooltipId).style.display = 'none';  // Hide tooltip on focus
  }
</script>

<style>

/* Osnovni stil za registraciju sekciju */
.register {
  background-color: #f4f4f4; /* Pozadina kao login sekcija */
  min-height: 100vh; /* Minimum visina sekcije */
  display: flex;
  justify-content: center; /* Centriraj horizontalno */
  align-items: center; /* Centriraj vertikalno */
  padding: 20px; /* Razmak oko sekcije */
}

/* Kontejner za formu sa registracijom */
.register-container {
  background-color: #fff; /* Bela pozadina za kontejner */
  padding: 30px;
  border-radius: 8px; /* Zaobljeni uglovi */
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); /* Senka oko kontejnera */
  width: 100%;
  max-width: 400px; /* Maksimalna širina */
  box-sizing: border-box;
}

/* Forma unutar kontejnera */
.register-form {
  display: flex;
  flex-direction: column;
  gap: 20px; /* Razmak između polja */
}

/* Stilizacija za input polja (ime, prezime, email, lozinka) */
.email, .password, .first-name, .last-name {
  display: flex;
  flex-direction: column;
  margin-bottom: 15px; /* Razmak ispod input polja */
}

input[type="email"],
input[type="password"],
input[type="text"] {
  padding: 12px; /* Veći padding za input polja */
  margin: 5px 0;
  border-radius: 5px;
  border: 1px solid #ddd; /* Sivo-bela granica */
  width: 100%; /* Puni širinu input polja */
  box-sizing: border-box; /* Uključuje padding i border u ukupnu širinu */
  font-size: 1.6rem; /* Veći font za input */
  transition: border 0.3s ease; /* Efekat pri fokusu */
}

/* Fokus na input poljima */
input[type="email"]:focus,
input[type="password"]:focus,
input[type="text"]:focus {
  border-color: #0D40C4;
  outline: none;
}

/* Dugme za submit */
.btn {
  padding: 12px; /* Veći padding na dugmetu */
  background-color: #0D40C4; /* Plava pozadina */
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  width: 100%; /* Puni širinu za dugme */
  font-size: 1.6rem; /* Veći font */
  transition: background-color 0.3s ease;
}

.btn:hover {
  background-color: #083c92; /* Tamnija nijansa pri hover-u */
}

/* Linkovi */
a {
  text-decoration: none;
  color: #0D40C4; /* Plava boja linkova */
  font-size: 1.6rem; /* Smanjeni font za linkove */
  text-align: center;
  margin-top: 10px;
}

a:hover {
  text-decoration: underline;
}

/* Tooltip stilizacija */
.tooltip {
  color: red;
  font-size: 12px;
  margin-left: 5px;
}

/* Remember me checkbox stilizacija */
.remember-me {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 1.6rem;
  color: #555;
}

.remember-me input[type="checkbox"] {
  width: auto;
  height: auto;
  margin: 0;
}

.remember-me label {
  margin-top: 0;
  font-weight: normal;
}

.remember-me label:hover {
  text-decoration: underline;
}

/* Stil za povratak na login stranu */
#recover-password {
  color: #0D40C4;
  font-size: 1.6rem;
  text-align: right;
  margin-top: 10px;
}

#recover-password:hover {
  text-decoration: underline;
}

/* Greške u formi */
.form-errors {
  color: red;
  font-size: 1.6rem;
  margin-top: 10px;
}

a[href="/pages/register"] {
  text-align: center;
  display: block;
  margin-top: 20px;
  font-size: 1.6rem;
  color: #0D40C4;
}

a[href="/pages/register"]:hover {
  text-decoration: underline;
}

/* Mobilna responzivnost */
@media (max-width: 480px) {
  .register-container {
    padding: 20px;
  }

  input[type="email"],
  input[type="password"],
  input[type="text"],
  .btn {
    font-size: 1.6rem;
  }

  .remember-me {
    font-size: 0.8rem;
  }
}

</style>

{% schema %}
  {
    "name": "Register"
  }
{% endschema %}
